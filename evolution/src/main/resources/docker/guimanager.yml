guimanager:
  image: ${env.DOCKER_REGISTRY}ev-guimanager:${project.name}-${project.version}
  user: '<_DOCKER_UID_>:<_DOCKER_GID_>'
  environment:
    KAFKA_BROKER_ID: ignored
    KAFKA_ZOOKEEPER_CONNECT: ignored
    CUB_ZOOKEEPER_MIN_NODES: <_ZOOKEEPER_MIN_NODES_>
    CUB_ZOOKEEPER_TIMEOUT: <_STARTUP_DEPENDENCY_TIMEOUT_>
    BROKER_SERVERS: <_BROKER_SERVERS_>
    BROKER_COUNT: <_BROKER_COUNT_>
    CUB_BROKER_MIN_NODES: <_BROKER_MIN_NODES_>
    CUB_KAFKA_TIMEOUT: <_STARTUP_DEPENDENCY_TIMEOUT_>
    REGISTRY_SERVERS: <_REGISTRY_SERVERS_>
    CUB_REGISTRY_MIN_NODES: <_REGISTRY_MIN_NODES_>
    CUB_SCHEMA_REGISTRY_TIMEOUT: <_STARTUP_DEPENDENCY_TIMEOUT_>
    ZOOKEEPER_SERVERS: <_ZOOKEEPER_SERVERS_>
    ELASTICSEARCH_HOST: <_MASTER_ESROUTER_HOST_>
    ELASTICSEARCH_PORT: <_MASTER_ESROUTER_PORT_>
    ELASTICSEARCH_USERNAME: admin
    ELASTICSEARCH_USERPASSWORD: <_ELASTICSEARCH_ADMIN_PASSWORD_>
    ELASTICSEARCH_ADMIN_PASSWORD: <_ELASTICSEARCH_ADMIN_PASSWORD_>
    MASTER_ESROUTER_HOST: <_MASTER_ESROUTER_HOST_>
    MASTER_ESROUTER_PORT: <_MASTER_ESROUTER_PORT_>
    GRAFANA_HOST: <_MONITORING_HOST_>
    GRAFANA_USER: <_GRAFANA_USER_>
    GRAFANA_PASSWORD: <_GRAFANA_PASSWORD_>
    GRAFANA_FOR_GUI_PORT: <_GRAFANA_FOR_GUI_PORT_>
    MONITORING_HOST: <_MONITORING_HOST_>
    PROMETHEUS_CORE_PORT: <_PROMETHEUS_CORE_PORT_>
    PROMETHEUS_ENVIRONMENT_PORT: <_PROMETHEUS_ENVIRONMENT_PORT_>
    PROMETHEUS_APPLICATION_PORT: <_PROMETHEUS_APPLICATION_PORT_>
    CONNECT_CUB_ES_TIMEOUT: <_STARTUP_DEPENDENCY_TIMEOUT_>
    CONNECT_CUB_ES_SERVERS: <_ELASTICSEARCH_SERVERS_>
    CONNECT_CUB_ESROUTER_HOST: <_MASTER_ESROUTER_HOST_>
    CONNECT_CUB_ESROUTER_PORT: <_MASTER_ESROUTER_PORT_>
    GUIMANAGER_PORT: <_GUIMANAGER_PORT_>
    KAFKA_REPLICATION_FACTOR: <_KAFKA_REPLICATION_FACTOR_>
    KAFKA_DEBUG: <_GUIMANAGER_DEBUG_>
    JAVA_DEBUG_OPTS: -Xdebug -Xrunjdwp:transport=dt_socket,server=y,address=<_GUIMANAGER_DEBUG_PORT_>,suspend=n
    KAFKA_HEAP_OPTS: <_GUIMANAGER_HEAP_OPTS_>
    KAFKA_LOG4J_OPTS: -Dlog4j.configuration=file:/app/config/log4j-guimanager.xml
    KAFKA_OPTS: -javaagent:/app/jars/jmx_prometheus_javaagent-${jmx_prometheus_javaagent.version}.jar=<_GUIMANAGER_MONITORING_PORT_>:/app/config/guimanager_jmx.yml -Dnglm.schemaRegistryURL=<_REGISTRY_URL_> -Dnglm.converter=Avro -Dzookeeper.connect=<_ZOOKEEPER_SERVERS_> -Dbroker.servers=<_BROKER_SERVERS_> -Dnglm.zookeeper.root=${zookeeper.root} -Dredis.sentinels=<_REDIS_SENTINELS_> -Dredis.password=<_REDIS_PASSWORD_> -Dsubscriberprofile.endpoints=<_EVOLUTIONENGINE_SUBSCRIBERPROFILE_ENDPOINTS_> -Dnglm.license.nodeid=<_GUIMANAGER_HOST_> -Devolutionengine.streamthreads=<_EVOLUTIONENGINE_STREAMTHREADS_>
    ENTRYPOINT: guimanager
  deploy: 
    restart_policy:
      condition: <_DOCKER_RESTART_POLICY_>
      delay: 5s
      max_attempts: 3
      window: 120s
    mode: replicated
    replicas: 1
    placement:
      constraints:
        - engine.labels.hostname == <_GUIMANAGER_HOST_>
  networks:
    - outside
  volumes:
    - <_NGLM_CONFIG_LOGS_>/log4j-guimanager.xml:/app/config/log4j-guimanager.xml
    - type: bind
      source: <_NGLM_LOGS_>
      target: /app/logs
    - type: bind
      source: <_NGLM_UPLOADED_>
      target: /app/uploaded
    - type: bind
      source: <_NGLM_REPORTS_>
      target: /app/reports
    - type: bind
      source: <_NGLM_EXTRACTS_>
      target: /app/extracts
